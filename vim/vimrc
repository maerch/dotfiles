syntax on
filetype off
set noswapfile
set nocompatible

source ~/.vim/plugins.vim
source ~/.vim/unite.vim

set path=+**
set wildmenu

" check file change every 4 seconds ('CursorHold') and reload the buffer upon detecting change
set autoread
au CursorHold * checktime

colorscheme nova

" Status bar
let g:lightline = {
      \ 'colorscheme': 'nova',
      \ 'active': {
      \   'left': [ [ 'mode', 'paste' ],
      \             [ 'fugitive', 'filename' ] ]
      \ },
      \ 'component': {
      \   'fugitive': '%{exists("*fugitive#head")?fugitive#head():""}',
      \   'filename': '%{expand("%:h")}/%t'
      \ }
      \ }

" Always show the git gutter
set signcolumn=yes

" Show git gutter signs after typing
let g:gitgutter_realtime = 1

" Show line numbers
set number

" Always show the status bar
set laststatus=2

" Prevent encoding vietnam
set encoding=utf-8

" Wraps and indicates if a line was wrapped
set wrap
set showbreak=↪

" j/k working on wrapped lines
noremap j gj
noremap gj j
noremap gk k

" General indentation settings
set ts=2 sts=2 sw=2 expandtab

" Do a smart break of line (do not start at the beginning of the line but on
" the same indentation level)
set breakindent

" Working backspace
set backspace=2

" Turn on indentation based on the file type
filetype plugin indent on

" Intendation without losing visual selection
vmap > >gv
vmap < <gv

" Let the buffer change without saving the current buffer
set hidden

" No beep anymore
set visualbell

" Enable mouse support for all modes
set mouse=a

" Leader needs space
let mapleader = "\<Space>"

" Clear search with <leader><space>
nnoremap <leader><space> :noh<cr>

" Easy buffer navigation
noremap <C-h> <C-w>h
noremap <C-j> <C-w>j
noremap <C-k> <C-w>k
noremap <C-l> <C-w>l

" Split panes
nnoremap <silent> <Leader>sv <C-w>v
nnoremap <silent> <Leader>sh <C-w>S
nnoremap <silent> <Leader>sc <C-w>c
nnoremap <silent> <Leader>so <C-w>o
nnoremap <silent> <Leader>se <C-w>=

" Minimum number of lines above and below the cursor
set scrolloff=10

" Indicator line for 80 characters
highlight ColorColumn ctermbg=235
let &colorcolumn="80"

" Do not jump to the start of line while switching the buffers
set nostartofline

" Highlight current line
set cursorline
hi CursorLine term=bold cterm=bold

" Cursor is in the center after search
nnoremap n nzz
nnoremap N Nzz
nnoremap * *zz
nnoremap # #zz
nnoremap g* g*zz
nnoremap g# g#zz

" Search for visual selected text with //
vnoremap // y/<C-R>"<CR>

" Don't move on *
nnoremap * *<c-o>

" Highlight search
set hlsearch

" Incremental Search please
set incsearch

" Save all with the leader + w
nnoremap <Leader>w :wall<CR>

" Quit vim
nnoremap <Leader>q :q<CR>

" Unload (close) current buffer
nnoremap <Leader>d :bd<CR>

" copy visual selection to os clipboard
vmap <Leader>y "+y

" Reload the vimrc
nnoremap <Leader>r :source $MYVIMRC<CR>

" Toggle paste mode
set pastetoggle=<F10>

" Esc
imap jk <Esc>

" Substitution is always global
set gdefault

" Ale (async lint engine)
let g:ale_sign_column_always = 1
let g:ale_sign_error = '•'
let g:ale_sign_warning = '•'
let g:ale_echo_msg_error_str = 'E'
let g:ale_echo_msg_warning_str = 'W'
let g:ale_echo_msg_format = '[%linter%] %s [%severity%]'
let b:ale_linters = {'javascript': ['flow-language-server', 'eslint']}

nmap <silent> <C-k> <Plug>(ale_previous_wrap)
nmap <silent> <C-j> <Plug>(ale_next_wrap)

nnoremap <Leader>fd :ALEDetail<CR>
nnoremap <Leader>ft :ALEHover<CR>
nnoremap <Leader>fg :ALEGoToDefinition<CR>*
nnoremap <Leader>fr :ALEFindReferences<CR>

" Fugitive stuff
noremap <Leader>gh :Gbrowse<CR>
noremap <Leader>gb :Gblame<CR>
noremap <Leader>gs :Gstatus<CR>
noremap <Leader>gw :Gwrite<CR>
nnoremap <Leader>gd :Gdiff<CR>
nnoremap <Leader>ga :Git add %:p<CR><CR>
nnoremap <Leader>gl :silent! Glog<CR>:bot copen<CR>
nnoremap <Leader>gt :Gcommit -v -q %:p<CR>

" DelimitMate config
let b:delimitMate_expand_cr=1
let b:delimitMate_expand_space=1

" JSX (React) config
let g:jsx_ext_required = 0 " Allow JSX in normal JS files

" vim-rsi
" Remove meta mapping which interfere with the US/GER Umlaut mapping
let g:rsi_no_meta = 1

let g:user_emmet_settings = {
\    'javascript.jsx' : {
\        'extends' : 'jsx',
\        'quote_char': "'",
\    },
\}

let g:vim_jsx_pretty_colorful_config = 1

" Correct syntax-highlight for scss files (OSX)
au BufRead,BufNewFile *.scss set filetype=scss

" Ignore a lot of stuff
set wildignore+=*/tmp/*,*.so,*.swp,*.zip,*/_site/*,*/bower_components/*,*/node_modules/*

" Cursor shape in insert/normal mode
" For tmux running in iTerm2 on OS X
" http://vim.wikia.com/wiki/Change_cursor_shape_in_different_modes
"let &t_SI = "\<Esc>Ptmux;\<Esc>\<Esc>]50;CursorShape=1\x7\<Esc>\\"
"let &t_EI = "\<Esc>Ptmux;\<Esc>\<Esc>]50;CursorShape=0\x7\<Esc>\\"
let &t_SI = "\<Esc>]50;CursorShape=1\x7"
let &t_EI = "\<Esc>]50;CursorShape=0\x7"

" Highlight current column as well
au WinLeave * set nocursorline nocursorcolumn
au WinEnter * set cursorline cursorcolumn
set cursorline cursorcolumn

" vim-expand-region
vmap v <Plug>(expand_region_expand)
vmap <C-v> <Plug>(expand_region_shrink)

" Snippets
let g:UltiSnipsExpandTrigger="<tab>"
let g:UltiSnipsJumpForwardTrigger="<c-b>"
let g:UltiSnipsJumpBackwardTrigger="<c-z>"

" Trailing whitespace
set list
set listchars=tab:>·,trail:•

" aka 'Oh, that's the key I have been hitting by accident'
nnoremap Q <nop>
nnoremap R <nop>
